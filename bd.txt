CREATE DATABASE RegistroLlamadas;
GO

USE RegistroLlamadas;
GO

-- TABLA ESTADO
CREATE TABLE estado (
  id_estado INT PRIMARY KEY IDENTITY(1,1),
  descripcion VARCHAR(100) NOT NULL,
  tipo_estado INT NOT NULL
);
GO

-- TABLA ROL
CREATE TABLE rol (
  id_rol INT PRIMARY KEY IDENTITY(1,1),
  nombre VARCHAR(50) NOT NULL,
  descripcion VARCHAR(200)
);
GO

-- TABLA CLIENTE
CREATE TABLE cliente (
  id_cliente INT PRIMARY KEY IDENTITY(1,1),
  identificacion VARCHAR(50) NOT NULL,
  nombre VARCHAR(50) NOT NULL,
  primer_apellido VARCHAR(50),
  segundo_apellido VARCHAR(50),
  correo VARCHAR(100) UNIQUE NOT NULL,
  telefono VARCHAR(20),
  estado_id INT NOT NULL,
  FOREIGN KEY (estado_id) REFERENCES estado(id_estado)
);
GO

-- TABLA CENTRO
CREATE TABLE centro (
  id_centro INT PRIMARY KEY IDENTITY(1,1),
  nombre VARCHAR(200) NOT NULL,
  estado_id INT,
  FOREIGN KEY (estado_id) REFERENCES estado(id_estado)
);
GO

-- TABLA EQUIPOS
CREATE TABLE equipos (
  id_equipo INT PRIMARY KEY IDENTITY(1,1),
  nombre VARCHAR(50) NOT NULL,
  modelo VARCHAR(50) NOT NULL,
  marca VARCHAR(50) NOT NULL,
  condicion VARCHAR(50) NOT NULL,
  serie VARCHAR(100),
  activo VARCHAR(20),
  centro_id INT,
  estado_id INT,
  FOREIGN KEY (centro_id) REFERENCES centro(id_centro),
  FOREIGN KEY (estado_id) REFERENCES estado(id_estado)
);
GO

-- TABLA USUARIO
CREATE TABLE usuario (
  id_usuario INT PRIMARY KEY IDENTITY(1,1),
  usuario VARCHAR(20) NOT NULL,
  contrasena VARCHAR(250) NOT NULL,
  nombre VARCHAR(50) NOT NULL,
  primer_apellido VARCHAR(50),
  segundo_apellido VARCHAR(50),
  correo VARCHAR(100),
  telefono VARCHAR(20),
  estado_id INT NOT NULL,
  rol_id INT,
  FOREIGN KEY (estado_id) REFERENCES estado(id_estado),
  FOREIGN KEY (rol_id) REFERENCES rol(id_rol)
);
GO

-- TABLA LLAMADAS
CREATE TABLE llamadas (
  id_llamada INT PRIMARY KEY IDENTITY(1,1),
  fecha DATETIME NOT NULL,
  hora_inicio TIME NOT NULL,
  hora_final TIME,
  promat VARCHAR(20),
  asunto VARCHAR(200),
  correo_enviado BIT,
  equipo_id INT,
  usuario_id INT,
  estado_id INT,
  cliente_id INT,
  centro_id INT,
  FOREIGN KEY (equipo_id) REFERENCES equipos(id_equipo),
  FOREIGN KEY (usuario_id) REFERENCES usuario(id_usuario),
  FOREIGN KEY (estado_id) REFERENCES estado(id_estado),
  FOREIGN KEY (cliente_id) REFERENCES cliente(id_cliente),
  FOREIGN KEY (centro_id) REFERENCES centro(id_centro)
);
GO

-- TABLA ASIGNACIONES
CREATE TABLE asignaciones (
  id_asignacion INT PRIMARY KEY IDENTITY(1,1),
  llamada_id INT NOT NULL,
  personal_id INT NOT NULL,
  fecha_asignacion DATETIME NOT NULL,
  prioridad VARCHAR(50),
  FOREIGN KEY (llamada_id) REFERENCES llamadas(id_llamada),
  FOREIGN KEY (personal_id) REFERENCES usuario(id_usuario)
);
GO

-- TABLA BITACORA
CREATE TABLE bitacora (
  id_bitacora INT PRIMARY KEY IDENTITY(1,1),
  usuario_id INT NOT NULL,
  accion VARCHAR(20) NOT NULL,
  fecha DATETIME NOT NULL,
  tabla_afectada VARCHAR(50) NOT NULL,
  FOREIGN KEY (usuario_id) REFERENCES usuario(id_usuario)
);
GO
